[
{"creatorId":-1,"id":1,"name":"系统报表","script":null,"param":null,"datasource":null,"displayUri":null,"paramUri":null,"type":0,"remark":null,"parentId":0,"disabled":0,"needLog":1,"mailable":0},
{"creatorId":-1,"id":2,"name":"访问统计","code":null,"script":null,"param":null,"datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":0,"remark":null,"parentId":1,"disabled":0,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":3,"name":"数据服务列表","code":"GetAllServices","script":"SELECT DISTINCT pk, TEXT FROM (\n SELECT methodCnName AS pk, methodCnName AS TEXT, COUNT(*) times FROM dm_access_log WHERE accessTime > DATE_SUB(NOW(),INTERVAL 30 DAY) GROUP BY methodCnName \n) t\nWHERE t.times > 0 ORDER BY t.times DESC","param":null,"datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":4,"name":"访问人列表","code":"report_visitors","script":"select distinct u.id as pk, u.userName as text\n from dm_access_log l, um_user u\n where l.userId = u.id\n   and l.accessTime > date_sub(now(),interval 100 day)","param":"[\n  {'label':'是否缓存','type':'hidden','name':'noCache','defaultValue':'noCache'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":5,"name":"报表列表","code":"report_list","script":"select t.datasource, t.name, t.code, t.id, u.userName\n from dm_report t, um_user u\n  where  t.creatorId = u.id\n      and t.datasource is not null\n order by t.datasource","param":"[{'label':'是否缓存','type':'hidden','name':'noCache','defaultValue':'true'}]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":6,"name":"访问概要","code":"visit-summary","script":"<#if param4='1'>\nselect methodCnName f1,  ROUND(avg(runningTime/1000), 1)  f2, ROUND(max(runningTime/1000), 1) f3, \n          count(*)  f4, sum( case when runningTime>5000 then 1 else 0 end)  f5\n from dm_access_log l, um_user u\n where   l.userId = u.id\n      and l.accessTime >= ? <#if param2??> and l.accessTime < ?  </#if>\n      <#if param3??> and ( u.loginName in (${param3}) or u.userName in (${param3}) ) </#if>\n group by methodCnName\n order by f2 desc\n\n<#elseif param4='2'>\nSELECT operateTable  f1,  count(*)  f2, count(distinct operatorId) f3,  null f4, null f5\n FROM  component_log l left join um_user u on l.operatorId = u.id <#if param3??> and ( u.loginName in (${param3}) or u.userName in (${param3}) ) </#if>\n where l.operateTime >= ? <#if param2??> and l.operateTime < ?  </#if>\n  group by operateTable\n order by f1 desc\n\n<#elseif param4='3'>\nSELECT max(taskName)  f1, count(*)  f2, round(avg(runningMS)/1000, 1)  f3, round(max(runningMS/1000), 1) f4,\n\t round(avg( substring(detail, position('=' in detail)+1) )) f5\nFROM dm_etl_task_log l\nwhere exception='no'  and detail like '%total=%' \n    and l.excuteTime >= ? <#if param2??> and l.excuteTime < ?  </#if> <#if param3??>  </#if>\ngroup by taskId\n order by f3 desc\n\n<#elseif param4='4'>\nSELECT l.processResult f1,  count(*)  f2, count(distinct processor) f3,  count(distinct tableId) f4, count(distinct itemId) f5\n FROM  dm_workflow_log l\n where l.processTime >= ? <#if param2??> and l.processTime < ?  </#if>\n   <#if param3??> and l.processor in (${param3})  </#if>\n  group by l.processResult\n order by f1 desc\n\n</#if>","param":"[ \n   {'label':'访问时间从', 'type':'date', 'nullable':'false', 'defaultValue':'today - 100'},\n   {'label':'访问时间到', 'type':'date', 'nullable':'true', 'defaultValue':'today + 1'},\n   {'label':'访问人'},\n   {'label':'主题','options':{'codes':'1|2|3|4','names':'数据查询|数据录入|ETL|审批流程'},'defaultValue':'1'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"colDefs":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"mobilable":0,"domain":null},
{"creatorId":-1,"id":7,"name":"访问明细","code":"visit-trace","script":"<#if param5='1'>\nselect methodCnName 服务名称, methodName 方法, className 所属类,  params 参数, accessTime 访问时间, runningTime 运行时长, userName 访问人,concat(ip,origin) origin\nfrom (\n select methodCnName,methodName,className,replace(replace(params,'\\\"','\\''),',',' ') params,accessTime,runningTime,u.userName,l.origin,l.ip \n  from dm_access_log l, um_user u\n  where l.userId = u.id\n   <#if param1??> and l.methodCnName in (${param1}) </#if>\n   <#if param2??> and ( u.loginName in (${param2}) or u.userName in (${param2}) ) </#if>\n   and l.accessTime > ? <#if param4??> and l.accessTime < ?  </#if>\n) as t\norder by 运行时长 desc\n\n<#elseif param5='2'>\nselect operateTable 操作对象, operatorName 操作人, concat(operationCode, ':', substring(content, 1, 100)) 操作内容, operateTime 操作时间, operatorBrowser origin, operatorIP ip\n from component_log l\nwhere 1=1\n   <#if param1??> and l.operateTable in (${param1}) </#if>\n   <#if param2??> and l.operatorName in (${param2}) </#if>\n   and l.operatetime >= ? <#if param4??> and l.operatetime < ?  </#if>\norder by operateTime desc\n\n<#elseif param5='3'>\nSELECT applier 创建人, t.name 任务,  jobName 定时器, count(*)  异常次数,  GROUP_CONCAT(distinct detail, ' ') 异常原因, \n    Round(max(runningMS/1000),1) 耗时, min(excuteTime) 最早一次出错, max(excuteTime) 最近一次出错\nFROM dm_etl_task_log l, dm_etl_task t \nwhere l.taskId = t.id and exception = 'yes'\n  <#if param1??> and  t.name in (${param1}) </#if>\n  <#if param2??> and t.applier in (${param2}) </#if>\n  and l.excuteTime >= ? <#if param4??> and l.excuteTime < ?  </#if>\ngroup by t.name\norder by 创建人, 异常次数 desc\n\n<#elseif param5='4'>\nselect concat(r.name,':', l.itemId) 流程表, l.processResult 处理结果, l.processor 处理人, l.processOpinion 处理意见, l.processTime 处理时间, l.origin\n from dm_workflow_log l, dm_record r\n where l.tableId = r.id\n    <#if param1??> and l.processResult in (${param1}) </#if>\n    <#if param2??> and l.processor in (${param2}) </#if>\n    and l.processTime >= ? <#if param4??> and l.processTime < ?  </#if>\n order by 流程表 desc, l.processTime  desc\n\n</#if>","param":"[\n  {'label':'服务名称','type':'String','nullable':'true','multiple':'true'},\n  {'label':'访问人'},\n  {'label':'访问时间从','type':'date','nullable':'false','defaultValue':'today - 0'},\n  {'label':'访问时间到','type':'date','nullable':'true','defaultValue':'today + 1'},\n  {'label':'主题','options':{'codes':'1|2|3|4','names':'数据服务|数据操作|ETL|审批流程'},'defaultValue':'1'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":8,"name":"访问量走势","code":"visit-trend","script":"<#if param6='1'>\nselect  date_format(accessTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>)  name,  \n            ROUND(avg(runningTime)) value, count(*)  v2, count(distinct l.userId) 访问人数\n   from dm_access_log l, um_user u\n   where l.userId = u.id\n    <#if param1??> and l.methodCnName in (${param1}) </#if>\n    <#if param2??> and ( u.loginName in (${param2}) or u.userName in (${param2}) ) </#if>\n    and l.accessTime > ? <#if param4??> and l.accessTime < ?  </#if>\n  group by  date_format(accessTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>) \n\n<#elseif param6='2'>\nselect date_format(operatetime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>)  name, count(distinct operatorId) value, count(*)  v2\n  from component_log l\n  where 1=1\n    <#if param1??> and l.operateTable in (${param1}) </#if>\n    <#if param2??> and l.operatorName in (${param2}) </#if>\n    and l.operatetime >= ? <#if param4??> and l.operatetime < ?  </#if>\n  group by  date_format(operatetime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>) \n\n<#elseif param6='3'>\nSELECT  date_format(excuteTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>)  name, \n     round(avg(runningMS)) value,  sum( substring(detail, position('=' in detail)+1) )  v2\n  FROM dm_etl_task_log l, dm_etl_task t \n  where l.taskId = t.id and exception = 'no' and l.detail like '%total=%' \n    <#if param1??> and  t.name in (${param1}) </#if>\n    <#if param2??> and t.applier in (${param2}) </#if>\n    and l.excuteTime >= ? <#if param4??> and l.excuteTime < ?  </#if>\n  group by  date_format(excuteTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>) \n\n<#elseif param6='4'>\nselect date_format(processTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>) name, count(distinct processor) value, count(*) v2\n  from dm_workflow_log l\n  where 1=1\n    <#if param1??> and l.processResult in (${param1}) </#if>\n    <#if param2??> and l.processor in (${param2}) </#if>\n    and l.processTime >= ? <#if param4??> and l.processTime < ?  </#if>\n  group by  date_format(processTime, <#if param5='d'>'%m-%d'<#else>'%H'</#if>) \n\n\n</#if>\n order by name asc","param":"[\n  {'label':'服务名称','type':'String','nullable':'true','multiple':'false'},\n  {'label':'访问人'},\n  {'label':'访问时间从','type':'date','nullable':'false','defaultValue':'today - 30'},\n  {'label':'访问时间到','type':'date','nullable':'true','defaultValue':'today +1'},\n  {'label':'按','options':{'codes':'d|H','names':'日期|小时'},'defaultValue':'H','nullable':'false'},\n  {'label':'主题','options':{'codes':'1|2|3|4','names':'数据服务|数据操作|ETL|审批流程'},'defaultValue':'1'}\n]","datasource":"connectionpool","displayUri":"../../more/bi_template/ichart.html?type=Line2D","paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":9,"name":"统计用户访问情况","code":null,"script":"select userName 访问人, methodCnName 服务名称, methodName 方法, \n     min(accessTime) 第一次访问时间, max(accessTime) 最后访问时间, count(*) 访问次数 \n  from dm_access_log l, um_user u\n  where l.userId = u.id \n    <#if param1??> and u.userName in (${param1}) </#if>\n    and l.accessTime >= ?\n    and l.accessTime < ?\n  group by userName, methodCnName, methodName\n order by 访问人","param":"[\n  {'label':'访问人','type':'String','nullable':'true'},\n  {'label':'访问时间从','type':'date','nullable':'false','defaultValue':'today - 30'},\n  {'label':'访问时间到','type':'date','nullable':'false','defaultValue':'today + 1'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":0,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":10,"name":"统计服务访问占比","code":null,"script":"select methodCnName name, count(*) value\n from dm_access_log l \n where 0 = 0\n   and l.accessTime >= ?\n   and l.accessTime <= ?\n   and l.methodCnName not like 'Get%'\n group by methodCnName  \n order by value desc","param":"[ \n  {'label':'起始时间', 'type':'date', 'nullable':'false', 'defaultValue':'today - 30'}, \n  {'label':'结束时间', 'type':'date', 'nullable':'false', 'defaultValue':'today + 0'}\n]","datasource":"connectionpool","displayUri":"../../more/bi_template/ichart.html?type=Pie3D","paramUri":null,"icon":null,"type":1,"remark":"../../more/bi_template/ichart.html?type=Bar2D","parentId":2,"disabled":0,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":11,"name":"统计新增资源数","code":null,"script":"<#if param1='1'>\n  select u.userName as name, count(*) as value, count(distinct t.creatorId) v2 \n  from ${param2}  t, um_user u \n  where t.creatorId = u.id \n     and t.createTime >= ? and t.createTime <= ?\n  group by u.userName\n<#else>\n  select DATE_FORMAT(t.createTime,'%Y%m') as name, count(*) as value,  count(distinct t.creatorId) v2 \n  from ${param2}  t \n  where t.createTime >= ? and t.createTime <= ?\n  group by DATE_FORMAT(t.createTime,'%Y%m')\n</#if>","param":"[\n  {'label':'按','options':{'codes':'1|2','names':'按开发者|按月份'},'defaultValue':'2'},\n  {'label':'类型','options':{'codes':'dm_report|dm_record|cms_article|um_user','names':'数据报表|数据录入|文章|用户'},'defaultValue':'dm_report'},\n  {'label':'创建时间从','type':'date','nullable':'false','defaultValue':'today - 365'},\n  {'label':'创建时间到','type':'date','nullable':'false','defaultValue':'today + 1'}\n]","datasource":"connectionpool","displayUri":"../../more/bi_template/ichart.html?type=Column2D","paramUri":null,"icon":null,"type":1,"remark":"统计新增 报表/录入/文章/用户","parentId":2,"disabled":0,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":12,"name":"统计用户登录","code":null,"script":"<#if param3='1'>\nselect  date_format(operateTime, '%Y-%m-%d')   name,  count(distinct operationCode)  value, count(*) v2\nfrom component_log t\nwhere t.operateTable = '用户登录' and t.operateTime >= ?  and t.operateTime < ?\ngroup by  date_format(operateTime, '%Y-%m-%d')  \norder by  name\n<#else>\nselect t.operationCode 登录人, t.operatorName 登录账号, count(*) 登录次数\nfrom component_log t\nwhere t.operateTable = '用户登录' and t.operateTime >= ?  and t.operateTime < ?\ngroup by t.operationCode, t.operatorName\norder by 登录次数 desc\n</#if>","param":"[\n  {'label':'起始时间','type':'date','nullable':'false','defaultValue':'today-30'},\n  {'label':'结束时间','type':'date','nullable':'false','defaultValue':'today+1'},\n   {'label':'统计方式','options':{'codes':'1|2','names':'按日|按用户'},'defaultValue':'1'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":null,"icon":null,"type":1,"remark":"../../more/bi_template/ichart.html?type=Line2D","parentId":2,"disabled":0,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":13,"name":"异常反馈列表","code":"queryFeedback","script":"SELECT t.id, t.content, t.module, t.type, t.createTime, u.userName, t.commiter, t.state, t.processing, t.processor, t.updateTime, t.updator\nFROM x_feedback t, um_user u\nwhere t.creator = u.loginName\norder by t.id desc","param":"[\n{'label':'不要缓存','type':'hidden','name':'noCache','defaultValue':'true'}\n]","datasource":"connectionpool","displayUri":"../../more/feedback.html","paramUri":null,"icon":null,"type":1,"remark":null,"parentId":2,"disabled":1,"needLog":1,"mailable":0,"domain":null},
{"creatorId":-1,"id":14,"name":"ETL日志查询","code":"ETL_LOG","script":"select taskName 任务名称, excuteTime 结束时间, runningMS 耗时, exception 是否异常, detail 详情,  IFNULL(dataDay, maxID) 参数信息\n from dm_etl_task_log \n where 1=1\n     and excuteTime >= ? and excuteTime <= ?\n     <#if param3??> and taskName = ? </#if>\n     <#if param4??> and exception = ? </#if>\n     <#if param5??> and detail like '%${param5}%' </#if>\norder by id desc","param":"[\n  {'label':'访问时间从','type':'date','nullable':'false','defaultValue':'today - 3'},\n  {'label':'访问时间到','type':'date','nullable':'false','defaultValue':'today + 1'},\n  {'label':'任务','type':'string','nullable':'true','jsonUrl':'/tss/xdata/json/dm_etl_task'},\n  {'label':'是否异常','options':{'codes':'yes|no','names':'yes|no'}},\n  {'label':'日志内容'},\n  {'label':'是否缓存','type':'hidden','name':'noCache','defaultValue':'true'}\n]","datasource":"connectionpool","displayUri":null,"paramUri":"no-need","icon":null,"type":1,"remark":null,"parentId":2,"disabled":0,"needLog":0,"mailable":0,"mobilable":0,"domain":null}
]